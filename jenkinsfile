pipeline {
    agent any

		parameters {
			string{name: 'tomcatdev', defaultvalue:'35.178.235.249',description:'Staging Server'}
			string{name: 'tomcatprod', defaultvalue:'35.178.167.137',description:'Production Server'}
		}
		triggers {
			pollSCM{'* * * * *'}
		}
	stages{
		stage ('Build')
		{
			steps {
				sh 'mvn clean package'
			}
			post 
			{
				success {
					echo 'Now Archiving'
					archiveArtifacts artifacts:'**/target/*.war'
				}
			}
		}
		stage ('Deployment') {
			parallel{
				stage ('Deploy to staging'){
					steps {
						sh "scp -i /Documents/tomcatdemo.pem **/target/*.war ec2-user@${params.tomcatdev}:/var/lib/tomcat/webapps"
					}
				}
				stage ('Deploy to Production'){
					steps {
						sh "scp -i /Documents/tomcatdemo.pem **/target/*.war ec2-user@${params.tomcatprod}:/var/lib/tomcat/webapps"
					}
				}

			}
		}
		}

}
